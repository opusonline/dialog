/*!
 * jquery dialog 1.1
 *
 * Copyright 2011, Stefan Benicke (opusonline.at)
 * Dual licensed under the MIT or GPL Version 3 licenses. (LICENSES.txt)
 */
(function(y){var M=y(window),q=y(document),e=y("#dialog"),E=y("#dialog-overlay"),H=y("#dialog-loading"),i,R,l,c,n,k,t,h,B,J,I=".dialog",b=false,C=false,G=new Image(),g=/^#.+/,L=/\.(jpg|gif|png|bmp|jpeg)$/i,D=/^javascript:/i,F=/^(\d+)%$/,r=Math.max,Q=Math.min,O=0.2,P=27,z,A={speed:250,margin:30,overlayOpacity:0.3,overlayColor:"#333",type:"",href:"",content:"",ajax:{},buttons:[],width:560,height:340,maxWidth:null,maxHeight:null,autoSize:true,onStart:function(){},onComplete:function(){},onClosed:function(){},onCancel:function(){},onError:function(){}},a=function(S){if(!b){return}if(S.keyCode==P){S.preventDefault();y.dialog.close()}},N=function(){var S={display:"none"};if(!e.length){y("body").append(e=y("<div/>").attr("id","dialog").css(S).append(R=y("<div/>").attr("class","wrap"),l=y('<a href="javascript:void(0)" class="close">close</a>').click(y.dialog.close)),E=y("<div/>").attr("id","dialog-overlay").css(S).click(y.dialog.close),H=y("<div/>").attr("id","dialog-loading").css(S).click(y.dialog.cancel),i=y("<div/>").attr("id","dialog-temp").css({display:"none",position:"absolute"}))}},v=function(){t.onStart.call(h.pointer);x();C=false;var T=h.source,S=g.test(T)?"inline":L.test(T)?"image":t.content?"html":"ajax";if(t.type){S=t.type}if(h.is_iframe){S="iframe"}if(S=="iframe"){j()}else{if(S=="html"){K()}else{if(S=="inline"){p()}else{if(S=="image"){d()}else{if(S=="ajax"){m()}}}}}},d=function(){y.dialog.showLoading();G=new Image();G.onload=o;G.onerror=w;G.src=h.source},m=function(){y.dialog.showLoading();var S=t.href||h.source;z=y.ajax(y.extend({},{url:S,success:K,error:w},t.ajax))},x=function(){H.hide();G.onload=G.onerror=null;if(z){z.abort();z=null}},w=function(){var T=arguments[2]||'"'+h.source+'" not found.',S='<span class="error">Load Error! '+T+"</span>";t.onError.call(h.pointer);K(S)},o=function(){y.dialog.hideLoading();C=true;c=y("<img/>").attr({src:G.src}).css({width:G.width,height:G.height,"vertical-align":"middle"});f()},j=function(){c=y("<iframe/>").attr({src:h.source,name:"dialog-iframe",frameborder:0}).css({width:t.width,height:t.height,"vertical-align":"middle"});f()},p=function(){var S=t.href||h.source;c=y(S).after(n=y("<div/>")).show();f()},K=function(){y.dialog.hideLoading();var S=arguments[0]||t.content;c=y("<div/>").html(S);f()},f=function(){s();R.append(c);E.css({opacity:t.overlayOpacity,background:t.overlayColor,width:q.width(),height:q.height()}).fadeIn(t.speed);e.css({opacity:O,top:-J,left:B}).show().animate({opacity:1,top:0},t.speed,function(){b=true;t.onComplete.call(h.pointer)})},u=function(){k=y("<div/>").attr("class","buttons").insertAfter(R);var T=t.buttons,U=function(V){y(this).data("callback").call(c,V)};for(var S in T){y("<button/>").attr({type:"button"}).data("callback",T[S].click).html(T[S].text).click(U).appendTo(k)}},s=function(){R.empty();c.appendTo(i);var ae=e.outerWidth();if(t.buttons.length){u();l.hide()}var S=e.outerHeight(),ab=i.outerWidth(),V=i.outerHeight(),aa=M.width(),ad=M.height(),T=aa-ae-t.margin*2,W=ad-S-t.margin,ac=t.maxWidth,U=t.maxHeight,Z=h.is_iframe,X,Y;if(Z||!t.autoSize){ab=t.width;V=t.height}if(ac){X=ac.toString(10).match(F);T=X?T/100*Q(X[1],100):Q(ac,T)}if(U){X=U.toString(10).match(F);W=X?W/100*Q(X[1],100):Q(U,W)}if(V>W){if(C){Y=ab/V;V=W;ab=V*Y}else{V=W}}if(ab>T){if(C){Y=V/ab;ab=T;V=ab*Y}else{ab=T}}if(!C&&!Z){ab++}J=V+S;B=r((aa-ab-ae/2)/2,0);c.css({width:ab,height:V})};y.fn.dialog=function(S){var S=y.extend({},A,S);return this.each(function(){var W=y(this),X=S.href||W.attr("href"),V=W.hasClass("iframe"),U={pointer:W,source:X,is_iframe:V},T=function(Y){Y.preventDefault();t=S;h=U;v()};if(!X||D.test(X)||X=="#"){return}W.unbind(I).bind("click"+I,T)})};y.dialog=function(S){if(!S){return}var T=S.type=="iframe"?true:false;t=y.extend({},A,S);h={pointer:document,source:t.href,is_iframe:T};v()};y.dialog.defaults=function(S){y.extend(A,S)};y.dialog.showLoading=function(){H.show()};y.dialog.hideLoading=function(){H.hide()};y.dialog.cancel=function(){if(!h){y.dialog.hideLoading();return}t.onCancel.call(h.pointer);x()};y.dialog.close=function(){x();E.fadeOut(t.speed);e.animate({top:-J,opacity:O},t.speed,function(){b=false;if(n){n.after(c.hide()).remove();n=null}if(k){k.remove();k=null;l.show()}e.hide();t.onClosed.call(h.pointer)})};N();M.unbind(I).bind("keydown"+I,a)})(jQuery);