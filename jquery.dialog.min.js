/*!
 * jquery dialog 1.0
 *
 * Copyright 2011, Stefan Benicke (opusonline.at)
 * Dual licensed under the MIT or GPL Version 3 licenses. (LICENSES.txt)
 */
(function(y){var N=y(window),q=y(document),e=y("#dialog"),E=y("#dialog-overlay"),H=y("#dialog-loading"),i,S,l,c,n,k,t,h,C,J,I=".dialog",b=false,B=false,G=new Image(),g=/^#.+/,L=/\.(jpg|gif|png|bmp|jpeg)$/i,D=/^javascript:/i,F=/^(\d+)%$/,r=Math.max,R=Math.min,P=0.2,Q=27,z,A={speed:250,margin:30,overlayOpacity:0.3,overlayColor:"#fff",type:"",href:"",content:"",ajax:{},buttons:[],width:560,height:340,maxWidth:null,maxHeight:null,autoSize:true,onStart:function(){},onComplete:function(){},onClosed:function(){},onCancel:function(){},onError:function(){}},M=function(){return{width:N.width(),height:N.height()}},a=function(T){if(!b){return}if(T.keyCode==Q){T.preventDefault();y.dialog.close()}},O=function(){var T={display:"none"};if(!e.length){y("body").append(e=y("<div/>").attr("id","dialog").css(T).append(S=y("<div/>").attr("class","wrap"),l=y("<button/>").attr({type:"button","class":"close"}).html("close").click(y.dialog.close)),E=y("<div/>").attr("id","dialog-overlay").css(T).click(y.dialog.close),H=y("<div/>").attr("id","dialog-loading").css(T).click(y.dialog.cancel),i=y("<div/>").attr("id","dialog-temp").css({display:"none",position:"absolute"}))}C={width:e.outerWidth(),height:e.outerHeight()}},v=function(){t.onStart.call(h.pointer);x();B=false;var U=h.source,T=g.test(U)?"inline":L.test(U)?"image":t.content?"html":"ajax";if(t.type){T=t.type}if(h.is_iframe){T="iframe"}if(T=="iframe"){j()}else{if(T=="html"){K()}else{if(T=="inline"){p()}else{if(T=="image"){d()}else{if(T=="ajax"){m()}}}}}},d=function(){y.dialog.showLoading();G=new Image();G.onload=o;G.onerror=w;G.src=h.source},m=function(){y.dialog.showLoading();var T=t.href||h.source;z=y.ajax(y.extend({},{url:T,success:K,error:w},t.ajax))},x=function(){H.hide();G.onload=G.onerror=null;if(z){z.abort();z=null}},w=function(){var U=arguments[2]||'"'+h.source+'" not found.',T='<span class="error">Load Error! '+U+"</span>";t.onError.call(h.pointer);K(T)},o=function(){y.dialog.hideLoading();B=true;c=y("<img/>").attr({src:G.src}).css({width:G.width,height:G.height,"vertical-align":"middle"});f()},j=function(){c=y("<iframe/>").attr({src:h.source,name:"dialog-iframe",frameborder:0}).css({width:t.width,height:t.height,"vertical-align":"middle"});f()},p=function(){var T=t.href||h.source;c=y(T).after(n=y("<div/>")).show();f()},K=function(){y.dialog.hideLoading();var T=arguments[0]||t.content;c=y("<div/>").html(T);f()},f=function(){s();S.empty().append(c);if(t.buttons.length){u();l.hide()}J=e.outerHeight();var T=M(),V=e.outerWidth(),U=r((T.width-V)/2,0);E.css({opacity:t.overlayOpacity,background:t.overlayColor,width:q.width(),height:q.height()}).fadeIn(t.speed);e.css({opacity:P,top:-J,left:U}).show().animate({opacity:1,top:0},t.speed,function(){b=true;t.onComplete.call(h.pointer)})},u=function(){k=y("<div/>").attr("class","buttons").insertAfter(S);var U=t.buttons,V=function(W){y(this).data("callback").call(c,W)};for(var T in U){y("<button/>").attr({type:"button"}).data("callback",U[T].click).html(U[T].text).click(V).appendTo(k)}},s=function(){c.appendTo(i);var aa=M(),Z=i.outerWidth(),U=i.outerHeight(),ac=aa.width-C.width-t.margin*2,X=aa.height-C.height-t.margin*2,ab=t.maxWidth,T=t.maxHeight,Y=h.is_iframe,V,W;if(Y||!t.autoSize){Z=t.width;U=t.height}if(ab){V=ab.toString(10).match(F);ac=V?ac/100*R(V[1],100):R(ab,ac)}if(T){V=T.toString(10).match(F);X=V?X/100*R(V[1],100):R(T,X)}if(U>X){if(B){W=Z/U;U=X;Z=U*W}else{U=X}}if(Z>ac){if(B){W=U/Z;Z=ac;U=Z*W}else{Z=ac}}if(!B&&!Y){Z++}c.css({width:Z,height:U})};y.fn.dialog=function(T){var T=y.extend({},A,T);return this.each(function(){var X=y(this),Y=T.href||X.attr("href"),W=X.hasClass("iframe"),V={pointer:X,source:Y,is_iframe:W},U=function(Z){Z.preventDefault();t=T;h=V;v()};if(!Y||D.test(Y)||Y=="#"){return}X.unbind(I).bind("click"+I,U)})};y.dialog=function(T){if(!T){return}var U=T.type=="iframe"?true:false;t=y.extend({},A,T);h={pointer:document,source:t.href,is_iframe:U};v()};y.dialog.defaults=function(T){y.extend(A,T)};y.dialog.showLoading=function(){H.show()};y.dialog.hideLoading=function(){H.hide()};y.dialog.cancel=function(){if(!h){y.dialog.hideLoading();return}t.onCancel.call(h.pointer);x()};y.dialog.close=function(){x();E.fadeOut(t.speed);e.animate({top:-J,opacity:P},t.speed,function(){b=false;if(n){n.after(c.hide()).remove();n=null}if(k){k.remove();k=null;l.show()}e.hide();t.onClosed.call(h.pointer)})};O();N.unbind(I).bind("keydown"+I,a)})(jQuery);